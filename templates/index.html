<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Interface Caisse</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        h1, h2 { color: #333; }
        .tiles { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .tile { background: #4CAF50; color: white; padding: 20px; cursor: pointer; border-radius: 8px; flex: 0 0 150px; text-align: center; transition: transform 0.2s; }
        .tile:hover { transform: scale(1.05); }
        #panier { background: white; padding: 10px; border-radius: 5px; min-height: 50px; margin-bottom: 20px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; border: none; background: #2196F3; color: white; transition: background 0.2s; }
        button:hover { background: #0b7dda; }
    </style>
</head>
<body>
    <h1>Interface Caisse</h1>
    <div id="caisseDisplay"></div>

    <h2>Articles</h2>
    <div class="tiles">
        <div class="tile" onclick="ajouterArticle('Tarte flambée', 5.0)">Tarte flambée<br>5.00 €</div>
        <div class="tile" onclick="ajouterArticle('Supplément gratiné', 1.0)">Supplément gratiné<br>1.00 €</div>
        <div class="tile" onclick="ajouterArticle('Boisson sucrée / café / eau', 2.0)">Boisson<br>2.00 €</div>
        <div class="tile" onclick="ajouterArticle('Bouteille entière', 3.0)">Bouteille<br>3.00 €</div>
        <div class="tile" onclick="ajouterArticle('MrFreeze', 2.0)">MrFreeze<br>2.00 €</div>
        <div class="tile" onclick="ajouterArticle('Sandwich Merguez', 3.5)">Sandwich Merguez<br>3.50 €</div>
    </div>

    <h2>Panier</h2>
    <div id="panier"></div>

    <button onclick="validerVente()">✅ Valider la vente</button>

    <script>
        let panier = [];
        let caisse = "";

        // Demander la caisse au lancement
        window.onload = function() {
            caisse = prompt("Entrez le numéro de la caisse (ex: Caisse 1) :", "Caisse 1");
            if (!caisse) caisse = "Caisse 1";
            document.getElementById("caisseDisplay").innerText = "Caisse sélectionnée : " + caisse;
        };

        function ajouterArticle(nom, prix) {
            panier.push({nom: nom, prix: prix});
            afficherPanier();
        }

        function afficherPanier() {
            let total = panier.reduce((acc, p) => acc + p.prix, 0);
            let texte = panier.map(p => p.nom + " - " + p.prix.toFixed(2) + "€").join("<br>");
            texte += "<br><b>Total: " + total.toFixed(2) + "€</b>";
            document.getElementById("panier").innerHTML = texte;
        }

        function validerVente() {
            if (panier.length === 0) { alert("Panier vide !"); return; }
            let total = panier.reduce((acc, p) => acc + p.prix, 0);
            fetch("/api/save_sale", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({caisse: caisse, panier: panier, total: total})
            }).then(res => res.json()).then(data => {
                alert("Commande enregistrée !");
                panier = [];
                afficherPanier();
            });
        }
    </script>
</body>
</html>
